# Vulnerability

```{r, vul_functions}
source(here::here("R/full_report_functions", "plot_vulnerability.R"))

data <- read.csv(here::here("data", "Hare_et_al_2016_overall.csv"))
```

## Climate vulnerability

Climate vulnerability is sourced from Hare et al. (2016). The overall climate score for `r species` was `r data[data$Species == species, 2] %>% stringr::str_to_lower()` with `r data[data$Species == species, 3] %>% stringr::str_to_lower()` certainty.

```{r, clim_vul}
data <- read.csv(url("https://doi.org/10.1371/journal.pone.0146756.s001")) %>%
  dplyr::mutate(Species = Species %>%
                  stringr::str_to_sentence()) %>%
  dplyr::filter(Species == species) %>%
  dplyr::select(-Species)
```

### Figures
```{r, fig.height = 10}
plot_climate_vulnerability(data)
```

### Data
```{r}
make_html_table(data,
                col_names = c("Functional group", "Attribute", "Attribute category", 
                             "Expert score: low",
                             "Expert score: moderate",
                             "Expert score: high",
                             "Expert score: very high"))
```

## Habitat vulnerability

Habitat information is sourced from the `ecodata` package. 

```{r, hab_vul}
data <- ecodata::habitat_vulnerability %>%
  dplyr::filter(Species == species) %>%
  dplyr::select(-Species)

data <- data[,c(8, 1:7)]

make_html_table(data,
                col_names = c("EPU", "Habitat name", "Habitat vulnerability", 
                             "Importance of habitat to eggs/larvae",
                             "Importance of habitat to juveniles/YOY",
                             "Importance of habitat to adults",
                             "Importance of habitat to spawning adults",
                             "Overall species vulnerability"))

```
