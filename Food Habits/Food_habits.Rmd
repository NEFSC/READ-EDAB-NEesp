---
title: "Food Habits"
author: "Ricky Tabandera"
date: "12/2/2020"
output: html_document


---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r data loading and cleaning}
library(tidyverse)
library(nmfspalette)

#list.files(here::here("data"))
load(here::here("data","allfh.RData"))
stock_list_strata <-read.csv("https://raw.githubusercontent.com/NOAA-EDAB/ECSA/master/data/stock_list.csv")
stock_list<-stock_list_strata %>% distinct(common_name ,.keep_all = TRUE)
#prelimary function to summarize data

unique(stock_list$common_name)
stringr::str_to_lower( unique(allfh$pdcomnam))

#pdgutw or pdgutv (predator gut weight or volume) fills in if a volume was taken (converts to cubic cm to grams and visa versa with pdgutv)
#avoid pdswgt as it is incomplete 
# there are a number of different resolutions you can use: gencat (or gensci) is the coarsest-- all fish, and phyla of inverts; analcat is middle-- fishes to family, inverts to class; and collcat-- fish to species, inverts to class/family some species. Of course most of the diet samples aren't IDed to species due to digestion levels, so many stomachs include fish uncl (fish unclassified), AR (animal remains), or broad categories of fish or invertebrates (e.g. gadid, bivalve etc.).

# extract out the relevant cols by 


#species codes for stocks 
#1,13,15, 22  23  24  25  26  27  28  32  33  34  69  72  73  74  75  76  77  84 101 102 103 105 106 107 121 131 135 141 143 155 192 193 197 301 306 502 503  36 108
stock_codes<-stock_list$svspp

fh_by_sp<-allfh %>% filter(svspp==69)%>% select(yr5block, pdid,pynum, pyperi, pywgti, pyvoli, pylen,pyamtw, pyamtv, perpyv, perpyw, pdscinam, pdcomnam, pdcomnam, svspp, gensci, pyamtw, year,season, gencat, gensci, analcat, analsci,pdgutv)

#stomach contents to disreagrd 
gut_status_rm<-c("EMPTY", "BLOWN","MISCELLANEOUS","OTHER","UNOBS")
fh_by_sp<-fh_by_sp %>% filter(!analsci %in% gut_status_rm)


#picked analsci as it is a medium resolution 
t1<-fh_by_sp %>% group_by(yr5block,analsci) %>% mutate(num_fish=length(pdid))
t2<-t1 %>% mutate(occ= num_fish/count(yr5block))
t2<-t1 %>% count(pdid)

freq_by_sp<-fh_by_sp %>% 
  group_by(yr5block,analsci) %>%
  summarise(freq =length(analsci), vol=sum(pdgutv),occ=length(analsci)/length(unique(pdid)))






%>%
  mutate(num_percent= freq/sum(freq),vol_perc=vol/sum, freq_of_occ=)

t2<-freq_by_sp %>% group_by(yr5block) %>% table()


freq_by_sp<-freq_by_sp %>%
  mutate(SWDI= -freq*log(freq))

sum_by_sp<-freq_by_sp %>%
  group_by( yr5block) %>%
  summarise(per_year_SWDI= sum(SWDI))






#diversity index H is p


#shannon diversity index (H) measure of diversity where richness is weighted by evenness where larger index values can either be richer or more even
#alterntives are simpsons D


```

## Including Plots

You can also embed plots, for example:

```{r diversity plot, echo=FALSE}
sum_by_sp %>%
  ggplot2::ggplot(aes(x=yr5block,y=per_year_SWDI))+
  geom_point()+
  geom_line()+
  xlab("Year")+
  ylab("Food item diversity (H')")+
  theme_minimal()


```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
