---
author: "Ricky Tabandera"
date: "`r format(Sys.time(), '%d %b %Y')`"
output: html_document
params:
  stock:
    label: "Stock:"
    value: Alewife
    input: select
    choices: [smooth dogfish, spiny dogfish, barndoor skate, winter skate, clearnose skate, rosette skate, little skate, smooth skate, thorny skate, atlantic herring, alewife, blueback herring, silver hake, atlantic cod, haddock, pollock, white hake, red hake, cusk, atlantic halibut, american plaice, summer flounder, yellowtail flounder, winter flounder, atlantic mackerel, butterfish, bluefish, black sea bass, scup, acadian redfish,    atlantic wolffish,  ocean pout, atlantic menhaden,windowpane flounder]
  
title: "Commercial_landing of `r stringr::str_to_sentence(params$stock)`"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

```{r data processing}
#list.files(here::here("commercial"))


#load in the stocks managed in NEFSC
stock_list_all_strata <- read.csv("https://raw.githubusercontent.com/NOAA-EDAB/ECSA/master/data/stock_list.csv")
#lowercase all of the names
stock_list_all_strata$common_name <- stringr::str_to_lower(stock_list_all_strata$common_name)
#extract out the unique names and rename column  
stock_list<-stock_list_all_strata %>% distinct(common_name, .keep_all=TRUE)


#load commercial landings data
com_landings<-readr::read_csv(here::here("commercial","foss_ commercial_landings_NE_MA_1950_2019.csv"))
#renaming cols to aling with stocklist
com_landings<-com_landings %>% rename(common_name=`NMFS Name`)
#simplifying the names to be lowercase 
com_landings$common_name<-stringr::str_to_lower(com_landings$common_name)

#removing empty rows due to confidentiality and counting the number of records removed
confid<-com_landings %>% 
  filter(common_name =="withheld for confidentiality" | Confidentiality == "Confidential" )%>%
  group_by(Year) %>%
  summarise(count=n())
com_landings<-com_landings %>% filter( !Confidentiality == "Confidential" | common_name =="withheld for confidentiality" | is.na(Pounds) )


# removing aggrigated landings records and counting their occurance
grouped_landings<-com_landings %>% filter(stringr::str_detect(common_name, "\\*+"))

# rearranging the species names to align with NEFSC conventions
com_landings<-com_landings %>% filter(!stringr::str_detect(common_name, "\\*+"))

#splitting off the records without a comma


single_name<-com_landings %>% filter(!stringr::str_detect(common_name, "\\,\\s"))
multipe_name<-com_landings %>% filter(stringr::str_detect(common_name, "\\,\\s"))
split_names<-multipe_name%>% separate (col=common_name,sep ="\\,\\s", into = c("first" ,"second", "third"))
split_names<-select()

unique(stock_list$common_name)

pick_sp<-split_names %>% filter(stringr::str_detect(first, "flounder"))
pick_sp<- pick_sp %>% dplyr::mutate_if(first, first="")

# 
# com_landings<-com_landings %>% separate (col=common_name,sep ="\\,\\s", into = c("first" ,"second", "third"))
# 
# com_landings<-dplyr::mutate(first=replace(first, first== "shark", NA))









```


## Commercial Landings of `r params$stock` across states in the mid-Atlantic and north-east regions

This data was sourced from [FOSS - Fisheries One Stop Shop](https://foss.nmfs.noaa.gov/apexfoss/f?p=215:200:4615327020711::NO:::) and is inclusive of `r min(com_landings$Year) ` to `r max(com_landings$Year)`. The entire data set contains `r length(unique(com_landings$common_name))` species. A total of `r length(grouped_landings$common_name) ` aggrigated records were removed. These landing reports were aggrigations of mutiple species and can span several taxanomic groups were removied due to their lack of specificity. `r sum(confid$count) ` records were withheld due to confidentiality of thoese specific landings.
Figures produced reflect the coverage of the data. With stocks that have high coverage, a running average is calculated. In low coverage stocks, missing values are excluded and a simple time series is produced. 


```{r landings of single stock, echo=FALSE}

```

## Landings of `r params$stock` across 
