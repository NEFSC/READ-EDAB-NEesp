---
author: "Ricky Tabandera"
date: "`r format(Sys.time(), '%d %b %Y')`"
output: html_document
params:
  stock:
    label: "Stock:"
    value: alewife
    input: select
    choices: [haddock, yellowtail flounder, atlantic cod,  red hake, pollock, scup, alewife, silver hake, atlantic mackerel, acadian redfish, winter flounder, summer flounder, american plaice, witch flounder, butterfish, white hake, blueback herring, black sea bass,   bluefish, atlantic herring,  ocean pout, monkfish,  little skate, winter skate,  windowpane flounder,  thorny skate, atlantic wolffish, cusk,   atlantic halibut, clearnose skate, smooth skate, offshore hake,  rosette skate,  barndoor skate, spiny dogfish, american lobster, smooth dogfish,  atlantic menhaden, longfin inshore squid, atlantic hagfish, northern shortfin squid ]
  
title: "Depth range of `r stringr::str_to_sentence(params$stock)`"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(here))
suppressPackageStartupMessages(library(survdat))
suppressPackageStartupMessages(library(dbutils))
```

## Depth range

The range of depths that a species occupies is linked to many other habitat characteristics such as benthic structure, food availability, or temperature. Thus, observed depth can signal changes in habitat suitability. Changes in this metric can indicate the required resources are changing their distribution on the landscape. Seasonal differences in occurrence can also help identify essential habitat and the timing of migration to acquire seasonal resources 


```{r data wrangleing, echo=FALSE, message=FALSE, error=FALSE}

#channel <- connect_to_database(server="sole",uid="RTABANDERA")

survdata<-readRDS(here::here("survdat_pull_bio.rds"))
survdata<-survdata %>% mutate(SVSPP=as.numeric(SVSPP))
stock_list_all_strata <- read.csv("https://raw.githubusercontent.com/NOAA-EDAB/ECSA/master/data/stock_list.csv")
stock_list_all_strata<-stock_list_all_strata %>% rename(SVSPP=svspp)
stock_list<-stock_list_all_strata %>% dplyr::distinct(SVSPP,.keep_all =T)

survdata.w.codes<-inner_join(survdata, stock_list, by= "SVSPP" )

# # abundance is adjusted but not length for bigalo data
# #groupdiscription =svspp
# # filter by group giv list of svspp codes
# get_fish_info()
# surv.species<-survdat::get_species(channel)
# 
# surv.species.1<-surv.species$data
# surv.code<-surv.species.1 %>% dplyr::distinct(SVSPP,.keep_all =T)

# black sea bass is svspp= 	141 bluefish =135

test.sp.code<-c(141,135)


selected.spp<-survdata.w.codes %>% filter(common_name==params$stock)

```

## 

```{r depth graph by season, echo=FALSE, message=FALSE, error=FALSE,, warning=FALSE}


selected.spp.sum<- selected.spp %>% group_by(YEAR, SEASON) %>% summarise(ave.d=mean(DEPTH), sd.d= sd(DEPTH,na.rm = TRUE),ave.t=mean(BOTTEMP), sd.t=sd(BOTTEMP,na.rm = TRUE))

selected.spp.sum %>%
  ggplot(aes(x=YEAR, y=-ave.d, color=SEASON, group=SEASON))+
  geom_line()+
  geom_point()+
  geom_pointrange(aes(ymin=-ave.d-sd.d, ymax=-ave.d+sd.d))+
  xlab("Year")+
  ylab("depth of trawl (ft)")+
  ggtitle("Seasonal depth profile of", subtitle=str_to_sentence(params$stock))+
  theme(axis.text.x = element_text(angle = 90))

```
```{r, bottom temp, echo=FALSE, message=FALSE, error=FALSE, warning=FALSE}


selected.spp.sum %>%
  ggplot(aes(x=YEAR, y=ave.t, color=SEASON, group=SEASON))+
  geom_line()+
  geom_point()+
  geom_pointrange(aes(ymin=ave.t-sd.t, ymax=ave.t+sd.t))+
  xlab("Year")+
  ylab("Bottom temperature (Â°C)")+
  ggtitle("Seasonal bottom temperature of tows that contain", subtitle=str_to_sentence(params$stock))+
  theme(axis.text.x = element_text(angle = 90))

```


