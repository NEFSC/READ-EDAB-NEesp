---
title: "recreational catch 1950-2019"
author: "Ricky Tabandera"
date: "11/18/2020
"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)


```



```{r }

library("tidyverse")


#read in recreational landings data
rec_landings_1950_2019<-readr::read_csv("foss_landings_REC_1950_2019_MA_NE.csv")
#extract the names of species
fish_list<-unique(rec_landings_1950_2019$`NMFS Name`)
#load in the stocks managed in NEFSC
stock_list_all_strata <- read.csv("https://raw.githubusercontent.com/NOAA-EDAB/ECSA/master/data/stock_list.csv")
stock_list_all_strata$common_name <- stringr::str_to_lower(stock_list_all_strata$common_name)
#extract out the names
stock_list<-as_tibble(unique(stock_list_all_strata$common_name),column_name = "common_name")
colnames(stock_list)<-"common_name"

#summarize the catches to species and year
rec_by_sp<-rec_landings_1950_2019 %>% group_by(`NMFS Name`,Year) %>% summarise(mean= mean(Pounds))
#lower case the name for easier comparisons
rec_by_sp$`NMFS Name`<-stringr::str_to_lower(rec_by_sp$`NMFS Name`)
#split out the records with commas to be re arranged
rec_w_comma<-rec_by_sp[str_detect(rec_by_sp$`NMFS Name`, "\\,\\s"),]
# detect the comma space formatting and seperate out each term 
rec_w_comma_split<-rec_w_comma %>% separate(col=`NMFS Name`,sep ="\\,\\s", into = c("first" ,"second", "third") )
#reorder the tibble to match NEFSC names
rec_w_comma_split<-rec_w_comma_split %>% select( third, second, first,Year, mean)
########################## renaming rows to align with NEFSC naming 

#removing the shark tag from the first name term


rec_w_comma_split[str_detect(rec_w_comma_split$first, "shark"),3]<-NA


#used to check for near matches 
fish_match<-rec_w_comma_whole[str_detect(rec_w_comma_whole$common_name, "herring"),]

rec_w_comma_union<-rec_w_comma_split %>% unite(col = "firstname", c(third, second),sep = " ", remove = TRUE ,na.rm = TRUE)
rec_w_comma_whole<-rec_w_comma_union %>% unite(col = "common_name", c(firstname, first ),sep = " ", remove = TRUE ,na.rm = TRUE)

#bring back in the records of single name fishes

rec_w_o_comma<-rec_by_sp[!str_detect(rec_by_sp$`NMFS Name`, "\\,\\s"),]
# rename col names to merge with the corrected dataset
colnames(rec_w_o_comma)<-c("common_name","Year","mean")
rec_by_sp_whole<-dplyr::bind_rows(rec_w_o_comma,rec_w_comma_whole)

#check how many matches already exist 
#there are 42 species in NEFSC stock list
length(stock_list$common_name)
length(stock_semi$common_name)
#only captured 23 of 42
stock_semi<-semi_join(stock_list, rec_by_sp_whole, by = "common_name") 
stock_missing<-anti_join(stock_list, stock_semi, by = "common_name") 
length(stock_missing$common_name)
#the missing stocks 
#  1 atlantic hagfish no records     
#  2 smooth dogfish   fixed        for smooth and spiny, removing the shark tag in the data import step
#  3 spiny dogfish    fixed      
#  5 offshore hake    multiple species, ECSA uses red and silver hake, not sure what to do with other species       
fish_match<-rec_w_comma_whole[str_detect(rec_w_comma_whole$common_name, "hake"),]
#  6 haddock  no haddock         
fish_match<-rec_w_comma_whole[str_detect(rec_w_comma_whole$common_name, "had"),]
#  7 pollock                
#  8 cusk                   
#  9 american plaice   
flounder
# 10 witch flounder         
# 11 butterfish             
# 12 bluefish               
# 13 scup                   
# 14 monkfish               
# 15 american lobster       
# 16 northern shrimp        
# 17 northern shortfin squid
# 18 longfin inshore squid  
# 19 windowpane flounder

rec_w_comma_whole$common_name


str_glue_data()






ggplot2::ggplot(rec_by_sp, aes(x=Pounds,))

length(unique(rec_landings_1950_2019$`NMFS Name`))

```

## Recreational catches time serise 
This data was sourced from [FOSS - Fisheries One Stop Shop](https://foss.nmfs.noaa.gov/apexfoss/f?p=215:200:4615327020711::NO:::) and is inclusive of `r min(rec_landings_1950_2019$Year) ` to `r max(rec_landings_1950_2019$Year)`. The entire data set contains `r length(unique(rec_landings_1950_2019$`NMFS Name`))` species. 

You can also embed plots, for example:

```{r pressure, echo=FALSE}




```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
