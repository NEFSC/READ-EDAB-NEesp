```{r, len_functions, include = FALSE}
source(here::here("R/full_report_functions", "get_length.R"))
```

```{r, len_data, include = FALSE}
# length data (survdat) already read in with habitat data
#survey_data <- params$survey_data
#survey_data <- survey_data[survey_data$Species == species, ]
```

## Length

Length data were pulled from ``r params$survey_source``. Only years with more than 10 fish lengths were considered for analysis. 

### Figures

Separate geom_gls() functions were fit for the minimum, mean, and maximum lengths; trend lines are only shown when the trend was statistically significant, so some plots may have fewer than three trend lines. Please note, sometimes the survey observed a small number of fish outside of the defined stock area.
```{r, length}
generate_len_plot(survey_data)
```

#### Risk {-}

See Methods for risk calculation details.
```{r}
indicators <- c("max_length_spring",
               "max_length_fall",
               "avg_length_spring",
               "avg_length_fall")
```

```{r, risk_stock, fig.height = length(indicators)}
plot_risk_by_year(risk_year_data,
                  indicator = indicators)

plot_risk_by_stock(risk_species_data,
                  indicator = indicators)
```

### Summary
```{r, length_summary}
generate_len_table(survey_data)
```

### Data
```{r, length_data}
data <- get_len_data2(survey_data) %>%
  character_to_factor()

make_html_table(data, col_names = c("Year", "Season", "Region", "Number of fish",
                       "Mean length", "Minimum length", "Maximum length"))
```
