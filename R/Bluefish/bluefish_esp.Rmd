---
title: "Preliminary Bluefish ESP"
author: "Abigail Tyrell"
date: "`r format(Sys.time(), '%d %b %Y')`"
output: 
  html_document:
    toc: true
    toc_float:
      toc_collapsed: false
    toc_depth: 3
    number_sections: true
github-repo: NOAA-EDAB/esp_data_aggregation
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      message = FALSE,
                      warning = FALSE, 
                      results = "asis",
                      fig.width = 8, 
                      fig.align = 'center')

library(ggplot2)
`%>%` <- dplyr::`%>%`

source(here::here("R/Bluefish", "indicator_functions.R"))

bluefish <- assessmentdata::stockAssessmentData %>% 
  dplyr::filter(Species == "Bluefish", AssessmentYear == 2019) %>%
  dplyr::rename(Time = Year)

```

# Introduction

These are prliminary regressions that compare bluefish catch, abundance, recruitment, and F to various indicators.

# Regression analysis

## Trends with time
```{r, time}
test <- bluefish %>%
  dplyr::mutate(Val = Time,
                Var = "Time") %>%
  dplyr::select(Time, Val, Var)
render_indicator(test)
```

## Physical indicators

### Cold pool index
```{r, cold_pool}
test <- ecodata::cold_pool
render_indicator(test)
```

### Warm pool index

### Marine heatwave index
```{r, heatwave}
test <- ecodata::heatwave %>%
  dplyr::rename(Val = Value)
render_indicator(test)
```

### GLORYS bottom temperature
```{r, glorys}
test <- ecodata::bottom_temp_glorys %>%
  dplyr::rename(Val = Value)
render_indicator(test)
```

### Spring offshore bottom temperature
Bluefish are typically found offshore in the spring.

### Fall onshore bottom temperature
Bluefish are typically found onshore in the fall.

### Gulf Stream Index
```{r, gsi}
test <- ecodata::gsi %>%
  dplyr::rename(Val = Value) %>%
  dplyr::mutate(Time = Time %>%
                  stringr::str_trunc(width = 4, ellipsis = "") %>%
                  as.numeric())
render_indicator(test)
```

### Chlorophyll
```{r, chl}
test <- ecodata::chl_pp %>%
  dplyr::rename(Val = Value) %>%
  dplyr::filter(EPU == "MAB") %>%
  dplyr::mutate(Var = Var %>%
                  stringr::str_replace_all("_", "\n") %>%
                  stringr::str_replace_all(" ", "\n"))
render_indicator(test)
```

## Trophic indicators

### Zooplankton abundance

### Small/large copepod anomaly

### Zooplankton diversity

### Spring ichthyoplankton diversity
```{r, forage_spring}
test <- ecodata::ichthyo_diversity  %>%
  dplyr::rename(Val = Value) %>%
  dplyr::filter(Season == "Spring")
render_indicator(test)
```

### Fall ichthyoplankton diversity
```{r, forage_fall}
test <- ecodata::ichthyo_diversity  %>%
  dplyr::rename(Val = Value) %>%
  dplyr::filter(Season == "Fall")
render_indicator(test)
```

### Forage fish abundance
```{r, forage}
test <- ecodata::forage_anomaly %>%
  dplyr::rename(Val = Value) 
render_indicator(test)
```

## Larvae and YOY indicators

### Recruitment

### Larval growth

### Juvenile indicators

### Length-age curves

### Condition

### CPUE

## Adult indicators

### Size of spawning stock

### Mean age of spawning stock

### Age distribution

### Length-age curves

### Condition

### Center of gravity and area occupied

## Socioeconomic indicators

### CPUE by catch strategy
